<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meeting Topics Collector</title>
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32' fill='none' width='32' height='32'><path d='M4 6C4 4.895 4.895 4 6 4H26C27.105 4 28 4.895 28 6V20C28 21.105 27.105 22 26 22H18L14 28L10 22H6C4.895 22 4 21.105 4 20V6Z' fill='%23111111'/><line x1='9' y1='11' x2='23' y2='11' stroke='white' stroke-width='2.5' stroke-linecap='round'/><line x1='9' y1='16' x2='19' y2='16' stroke='white' stroke-width='2.5' stroke-linecap='round' opacity='0.65'/></svg>">
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #fafafa;
      color: #333;
      line-height: 1.6;
    }

    .app {
      display: flex;
      height: 100vh;
    }

    .sidebar {
      width: 300px;
      background: #fff;
      border-right: 1px solid #e0e0e0;
      overflow-y: auto;
      padding: 20px;
      position: relative;
    }

    .sidebar h2 {
      font-size: 18px;
      font-weight: 600;
    }

    .meeting-item {
      padding: 12px;
      margin-bottom: 8px;
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }

    .meeting-item:hover {
      background: #f5f5f5;
    }

    .meeting-item.selected {
      background: #f0f0f0;
      border-color: #999;
    }

    .meeting-item.past {
      opacity: 0.5;
    }

    .meeting-date {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .meeting-time {
      font-size: 12px;
      color: #666;
    }

    .meeting-edit-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 24px;
      height: 24px;
      padding: 0;
      background: transparent;
      border: none;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.2s, background 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #666;
      border-radius: 6px;
    }

    .meeting-item:hover .meeting-edit-btn {
      opacity: 1;
    }

    .meeting-edit-btn:hover {
      background: #e8e8e8;
    }

    .past-meetings-toggle {
      padding: 12px;
      margin-top: 16px;
      margin-bottom: 8px;
      background: #fafafa;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: #666;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: background 0.2s;
    }

    .past-meetings-toggle:hover {
      background: #f0f0f0;
    }

    .main {
      flex: 1;
      overflow-y: auto;
      padding: 40px;
    }

    .header {
      margin-bottom: 32px;
    }

    .header-title-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }

    .header-title-row:hover .header-edit-btn {
      opacity: 1;
    }

    .header h1 {
      font-size: 24px;
      font-weight: 600;
    }

    .header-edit-btn {
      width: 28px;
      height: 28px;
      padding: 0;
      background: transparent;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      color: #666;
      opacity: 0;
      transition: opacity 0.2s, background 0.2s;
      border-radius: 6px;
    }

    .header-edit-btn:hover {
      background: #e8e8e8;
    }

    .header-actions {
      display: flex;
      gap: 12px;
      margin-top: 16px;
    }

    button {
      padding: 10px 20px;
      background: #333;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }

    button:hover {
      background: #555;
    }

    button.secondary {
      background: #fff;
      color: #333;
      border: 1px solid #e0e0e0;
    }

    button.secondary:hover {
      background: #f5f5f5;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal {
      background: #fff;
      padding: 32px;
      border-radius: 12px;
      max-width: 600px;
      width: 90%;
      overflow: visible;
      position: relative;
    }

    .modal h2 {
      font-size: 20px;
      margin-bottom: 24px;
      font-weight: 700;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 6px;
      color: #555;
    }

    input, select, textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
    }

    input:focus, select:focus, textarea:focus {
      outline: none !important;
      border-color: #333 !important;
      box-shadow: 0 0 0 3px rgba(51, 51, 51, 0.1) !important;
    }

    select {
      padding-right: 36px;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 12 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 4L6 8L10 4' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
    }

    select:focus {
      outline: none !important;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    .modal-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 24px;
    }

    .topic-card {
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
      position: relative;
    }

    .topic-card:hover .topic-delete-btn {
      opacity: 1 !important;
    }

    .topic-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .topic-meta {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      background: #f5f5f5;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 500;
    }

    .topic-description {
      color: #555;
      margin-bottom: 12px;
      white-space: pre-wrap;
    }

    .file-links {
      font-size: 13px;
    }

    .file-links a {
      color: #333;
      text-decoration: underline;
      margin-right: 12px;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .file-link-input {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    .file-link-input input {
      flex: 1;
    }

    .file-link-input button {
      padding: 8px 12px;
      font-size: 12px;
    }

    .datetime-inputs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 32px;
    }

    /* Mobile hamburger menu */
    .mobile-menu-btn {
      display: none;
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 999;
      width: 56px;
      height: 56px;
      background: #333;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      padding: 0;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
    }

    .mobile-menu-btn:active {
      transform: scale(0.95);
    }

    .mobile-menu-btn svg {
      color: #fff;
    }

    /* Mobile Responsive Styles */
    @media (max-width: 768px) {
      .app {
        flex-direction: column;
        position: relative;
      }

      .sidebar {
        position: fixed;
        top: 0;
        left: -100%;
        width: 80%;
        max-width: 300px;
        height: 100vh;
        z-index: 998;
        transition: left 0.3s ease;
        box-shadow: 2px 0 8px rgba(0,0,0,0.1);
      }

      .sidebar.open {
        left: 0;
      }

      .mobile-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 997;
      }

      .mobile-overlay.open {
        display: block;
      }

      .mobile-menu-btn {
        display: flex;
      }

      /* Always show edit buttons on mobile */
      .meeting-edit-btn {
        opacity: 1 !important;
      }

      .header-edit-btn {
        opacity: 1 !important;
      }

      .topic-delete-btn {
        opacity: 1 !important;
      }

      .main {
        width: 100%;
        padding: 20px 16px 20px 16px;
      }

      .header h1 {
        font-size: 20px;
      }

      .topic-card {
        padding: 16px;
      }

      .modal > div,
      .settings-modal {
        width: 95% !important;
        max-width: 95% !important;
        padding: 24px !important;
        max-height: 85vh !important;
      }

      .modal h2 {
        font-size: 20px !important;
      }

      /* Settings modal specific mobile fixes */
      .settings-modal {
        max-width: 500px !important;
      }

      .settings-modal * {
        max-width: 100%;
      }

      .settings-modal h2 {
        font-size: 20px !important;
        margin-bottom: 20px !important;
      }

      .settings-modal h3 {
        font-size: 11px !important;
      }

      /* Stack Start Time and End Time vertically on mobile */
      .settings-modal > form > div:nth-child(2) > div:nth-child(3) {
        display: flex !important;
        flex-direction: column !important;
        gap: 16px !important;
      }

      /* Override inline grid styles - force single column for dates */
      .settings-modal div[style*="gridTemplateColumns"] {
        display: block !important;
        grid-template-columns: 1fr !important;
      }

      .settings-modal div[style*="gridTemplateColumns"] > div {
        margin-bottom: 12px !important;
      }

      /* Day selector - make buttons perfectly circular */
      .settings-modal button[title="Sunday"],
      .settings-modal button[title="Monday"],
      .settings-modal button[title="Tuesday"],
      .settings-modal button[title="Wednesday"],
      .settings-modal button[title="Thursday"],
      .settings-modal button[title="Friday"],
      .settings-modal button[title="Saturday"] {
        width: 40px !important;
        height: 40px !important;
        min-width: 40px !important;
        min-height: 40px !important;
        font-size: 12px !important;
        flex-shrink: 0 !important;
      }

      /* Mobile calendar picker fix - use native inputs */
      .native-date-input {
        display: none;
      }

      .custom-date-button {
        display: flex;
      }

      @media (max-width: 768px) {
        .native-date-input {
          display: block !important;
        }

        .custom-date-button {
          display: none !important;
        }

        /* Hide custom calendar picker on mobile */
        .settings-modal div[style*="position: 'absolute'"][style*="zIndex: 1001"],
        .modal div[style*="position: 'absolute'"][style*="zIndex: 1001"] {
          display: none !important;
        }
      }

      /* Day selector container - center and wrap */
      .settings-modal div[style*="display: 'flex'"][style*="gap: '8px'"],
      .settings-modal div[style*='display: "flex"'][style*='gap: "8px"'] {
        gap: 6px !important;
        flex-wrap: wrap !important;
        justify-content: center !important;
      }

      /* Time selector inputs */
      .settings-modal select {
        min-width: 60px !important;
      }

      .form-group {
        margin-bottom: 16px;
      }

      .datetime-inputs {
        grid-template-columns: 1fr !important;
        gap: 16px !important;
      }

      /* Make buttons more touch-friendly */
      button {
        min-height: 44px;
      }

      /* Password protection modal */
      .password-container {
        padding: 32px 24px !important;
      }

      /* Stack time inputs vertically on very small screens */
      @media (max-width: 480px) {
        .modal > div,
        .settings-modal {
          padding: 20px !important;
        }
        
        .settings-modal {
          max-width: 95% !important;
        }
        
        .settings-modal h2 {
          font-size: 18px !important;
        }
        
        /* Make day buttons even smaller on tiny screens */
        .settings-modal button[title="Sunday"],
        .settings-modal button[title="Monday"],
        .settings-modal button[title="Tuesday"],
        .settings-modal button[title="Wednesday"],
        .settings-modal button[title="Thursday"],
        .settings-modal button[title="Friday"],
        .settings-modal button[title="Saturday"] {
          width: 36px !important;
          height: 36px !important;
          font-size: 11px !important;
        }
        
        .password-container {
          padding: 24px 20px !important;
        }
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCV-zChKyxbTIS5WTU6uUwJ-GjRNjO0MmU",
      authDomain: "meeting-topic-collector.firebaseapp.com",
      projectId: "meeting-topic-collector",
      storageBucket: "meeting-topic-collector.firebasestorage.app",
      messagingSenderId: "540138164282",
      appId: "1:540138164282:web:9626184576a0ed4d63a503"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const { useState, useEffect, useMemo } = React;

    // Password Protection Component
    function PasswordProtection({ onAuthenticated }) {
      const [passcode, setPasscode] = useState('');
      const [error, setError] = useState('');
      const [savedPasscode, setSavedPasscode] = useState(null);
      const [isLoading, setIsLoading] = useState(true);
      const [showPassword, setShowPassword] = useState(false);

      useEffect(() => {
        // Load passcode from Firestore
        db.collection('settings').doc('passcode').get().then(doc => {
          if (doc.exists && doc.data().value) {
            setSavedPasscode(doc.data().value);
          } else {
            // No passcode set, create default one
            const defaultPasscode = 'topics2026';
            db.collection('settings').doc('passcode').set({ value: defaultPasscode });
            setSavedPasscode(defaultPasscode);
          }
          setIsLoading(false);
        });
      }, []);

      const handleSubmit = (e) => {
        e.preventDefault();
        if (passcode === savedPasscode) {
          sessionStorage.setItem('authenticated', 'true');
          onAuthenticated();
        } else {
          setError('Incorrect passcode');
          setPasscode('');
        }
      };

      if (isLoading) {
        return (
          <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', height: '100vh', background: '#fafafa' }}>
            <div style={{ fontSize: '16px', color: '#666' }}>Loading...</div>
          </div>
        );
      }

      return (
        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', height: '100vh', background: '#fafafa' }}>
          <div className="password-container" style={{ background: '#fff', padding: '48px', borderRadius: '12px', boxShadow: '0 4px 16px rgba(0,0,0,0.1)', maxWidth: '400px', width: '90%' }}>
            <h1 style={{ fontSize: '24px', fontWeight: 700, marginBottom: '8px', textAlign: 'center' }}>Meeting Topics Collector</h1>
            <p style={{ fontSize: '14px', color: '#666', marginBottom: '32px', textAlign: 'center' }}>Enter passcode to continue</p>
            
            <form onSubmit={handleSubmit}>
              <div style={{ marginBottom: '24px' }}>
                <div style={{ position: 'relative' }}>
                  <input
                    type={showPassword ? "text" : "password"}
                    value={passcode}
                    onChange={(e) => setPasscode(e.target.value)}
                    placeholder="Enter passcode"
                    autoFocus
                    style={{
                      width: '100%',
                      padding: '14px',
                      paddingRight: '48px',
                      border: '1px solid #e0e0e0',
                      borderRadius: '8px',
                      fontSize: '16px',
                      outline: 'none'
                    }}
                    onFocus={(e) => { e.target.style.borderColor = '#333'; e.target.style.boxShadow = '0 0 0 3px rgba(51, 51, 51, 0.1)'; }}
                    onBlur={(e) => { e.target.style.borderColor = '#e0e0e0'; e.target.style.boxShadow = 'none'; }}
                  />
                  <button
                    type="button"
                    onClick={() => setShowPassword(!showPassword)}
                    style={{
                      position: 'absolute',
                      right: '12px',
                      top: '50%',
                      transform: 'translateY(-50%)',
                      background: 'transparent',
                      border: 'none',
                      cursor: 'pointer',
                      padding: '4px',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      color: '#666'
                    }}
                  >
                    {showPassword ? (
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46A11.804 11.804 0 0 0 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>
                      </svg>
                    ) : (
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                      </svg>
                    )}
                  </button>
                </div>
                {error && (
                  <div style={{ color: '#ff4444', fontSize: '13px', marginTop: '8px', textAlign: 'center' }}>{error}</div>
                )}
              </div>
              
              <button
                type="submit"
                style={{
                  width: '100%',
                  padding: '14px',
                  background: '#333',
                  color: '#fff',
                  border: 'none',
                  borderRadius: '8px',
                  fontSize: '16px',
                  fontWeight: 600,
                  cursor: 'pointer'
                }}
                onMouseEnter={(e) => { e.target.style.background = '#555'; }}
                onMouseLeave={(e) => { e.target.style.background = '#333'; }}
              >
                Enter
              </button>
            </form>
          </div>
        </div>
      );
    }


    // Topic types with priority order
    const TOPIC_TYPES = {
      QUESTION: { label: 'Question', priority: 4 },
      GET_FEEDBACK: { label: 'Get Feedback', priority: 3 },
      PURE_SHARING: { label: 'Sharing', priority: 2 },
      DISCUSSION: { label: 'Discussion', priority: 1 }
    };

    const URGENCY_LEVELS = [
      { value: 5, label: 'Critical' },
      { value: 4, label: 'High' },
      { value: 3, label: 'Medium' },
      { value: 2, label: 'Low' }
    ];

    // Generate all meetings for 2026
    // Generate meetings based on settings
    function generateMeetingsFromSettings(savedSettings = {}) {
      const startDateStr = savedSettings.startDate || '2026-01-08T00:00:00-08:00';
      const endDateStr = savedSettings.endDate || '2026-12-31T00:00:00-08:00';
      const daysOfWeek = savedSettings.daysOfWeek || [4];
      const frequency = savedSettings.frequency || 'weekly';
      const interval = savedSettings.interval || 1;
      
      const startHour = savedSettings.startHour ?? 1;
      const startMinute = savedSettings.startMinute ?? 0;
      const startAmPm = savedSettings.startAmPm || 'PM';
      const endHour = savedSettings.endHour ?? 1;
      const endMinute = savedSettings.endMinute ?? 45;
      const endAmPm = savedSettings.endAmPm || 'PM';
      
      const start24Hour = startAmPm === 'PM' && startHour !== 12 ? startHour + 12 : (startAmPm === 'AM' && startHour === 12 ? 0 : startHour);
      const end24Hour = endAmPm === 'PM' && endHour !== 12 ? endHour + 12 : (endAmPm === 'AM' && endHour === 12 ? 0 : endHour);
      
      console.log('Generating meetings with settings:', {
        startTime: `${startHour}:${String(startMinute).padStart(2, '0')} ${startAmPm}`,
        endTime: `${endHour}:${String(endMinute).padStart(2, '0')} ${endAmPm}`,
        start24Hour,
        end24Hour,
        startMinute,
        endMinute
      });
      
      const startDate = new Date(startDateStr);
      const endDate = new Date(endDateStr);
      const meetings = [];
      
      const dstStart = new Date('2026-03-08T02:00:00');
      const dstEnd = new Date('2026-11-01T02:00:00');
      
      if (frequency === 'weekly') {
        daysOfWeek.forEach(targetDay => {
          let currentDate = new Date(startDate);
          
          while (currentDate.getDay() !== targetDay) {
            currentDate.setDate(currentDate.getDate() + 1);
          }
          
          while (currentDate <= endDate) {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth() + 1;
            const day = currentDate.getDate();
            
            const isDST = currentDate >= dstStart && currentDate < dstEnd;
            const tzOffset = isDST ? '-07:00' : '-08:00';
            
            const startStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}T${String(start24Hour).padStart(2, '0')}:${String(startMinute).padStart(2, '0')}:00${tzOffset}`;
            const endStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}T${String(end24Hour).padStart(2, '0')}:${String(endMinute).padStart(2, '0')}:00${tzOffset}`;
            
            meetings.push({
              id: crypto.randomUUID(),
              startDateTime: startStr,
              endDateTime: endStr
            });
            
            currentDate.setDate(currentDate.getDate() + (7 * interval));
          }
        });
      } else if (frequency === 'daily') {
        let currentDate = new Date(startDate);
        
        while (currentDate <= endDate) {
          const year = currentDate.getFullYear();
          const month = currentDate.getMonth() + 1;
          const day = currentDate.getDate();
          
          const isDST = currentDate >= dstStart && currentDate < dstEnd;
          const tzOffset = isDST ? '-07:00' : '-08:00';
          
          const startStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}T${String(start24Hour).padStart(2, '0')}:${String(startMinute).padStart(2, '0')}:00${tzOffset}`;
          const endStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}T${String(end24Hour).padStart(2, '0')}:${String(endMinute).padStart(2, '0')}:00${tzOffset}`;
          
          meetings.push({
            id: crypto.randomUUID(),
            startDateTime: startStr,
            endDateTime: endStr
          });
          
          currentDate.setDate(currentDate.getDate() + interval);
        }
      } else if (frequency === 'monthly') {
        let currentDate = new Date(startDate);
        const startDay = currentDate.getDate();
        
        while (currentDate <= endDate) {
          const year = currentDate.getFullYear();
          const month = currentDate.getMonth() + 1;
          const day = currentDate.getDate();
          
          const isDST = currentDate >= dstStart && currentDate < dstEnd;
          const tzOffset = isDST ? '-07:00' : '-08:00';
          
          const startStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}T${String(start24Hour).padStart(2, '0')}:${String(startMinute).padStart(2, '0')}:00${tzOffset}`;
          const endStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}T${String(end24Hour).padStart(2, '0')}:${String(endMinute).padStart(2, '0')}:00${tzOffset}`;
          
          meetings.push({
            id: crypto.randomUUID(),
            startDateTime: startStr,
            endDateTime: endStr
          });
          
          currentDate.setMonth(currentDate.getMonth() + interval);
          if (currentDate.getDate() !== startDay) {
            currentDate.setDate(0);
          }
        }
      }
      
      // Remove any duplicate dates - check full datetime string
      const uniqueMeetings = [];
      const seenDateTimes = new Set();
      
      meetings.forEach(meeting => {
        // Create unique key from start date and time
        const dateTimeKey = meeting.startDateTime;
        if (!seenDateTimes.has(dateTimeKey)) {
          seenDateTimes.add(dateTimeKey);
          uniqueMeetings.push(meeting);
        } else {
          console.log('Duplicate found and removed:', dateTimeKey);
        }
      });
      
      console.log('Total meetings before dedup:', meetings.length, 'After dedup:', uniqueMeetings.length);
      
      return uniqueMeetings.sort((a, b) => new Date(a.startDateTime) - new Date(b.startDateTime));
    }

    // Legacy function for backward compatibility
    function generateMeetingsFor2026() {
      return generateMeetingsFromSettings();
    }

    // Fix meeting times to ensure 1:00-1:45 PM
    function fixMeetingTimes(meetings) {
      const dstStart = new Date('2026-03-08T02:00:00');
      const dstEnd = new Date('2026-11-01T02:00:00');
      
      return meetings.map(meeting => {
        const start = new Date(meeting.startDateTime);
        const year = start.getFullYear();
        const month = start.getMonth() + 1;
        const day = start.getDate();
        
        const meetingDate = new Date(year, month - 1, day);
        const isDST = meetingDate >= dstStart && meetingDate < dstEnd;
        const tzOffset = isDST ? '-07:00' : '-08:00';
        
        return {
          ...meeting,
          startDateTime: `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}T13:00:00${tzOffset}`,
          endDateTime: `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}T13:45:00${tzOffset}`
        };
      });
    }

    // Convert Date object to PST/PDT string
    function dateToLocalString(date) {
      const dstStart = new Date('2026-03-08T02:00:00');
      const dstEnd = new Date('2026-11-01T02:00:00');
      
      const year = date.getFullYear();
      const month = date.getMonth() + 1;
      const day = date.getDate();
      const hours = date.getHours();
      const minutes = date.getMinutes();
      
      const meetingDate = new Date(year, month - 1, day);
      const isDST = meetingDate >= dstStart && meetingDate < dstEnd;
      const tzOffset = isDST ? '-07:00' : '-08:00';
      
      return `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}T${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:00${tzOffset}`;
    }

    // Strict deterministic sort
    function sortTopics(topics) {
      return [...topics].sort((a, b) => {
        if (a.urgency !== b.urgency) return b.urgency - a.urgency;
        
        const aPriority = TOPIC_TYPES[a.type].priority;
        const bPriority = TOPIC_TYPES[b.type].priority;
        if (aPriority !== bPriority) return bPriority - aPriority;
        
        if (a.durationMinutes !== b.durationMinutes) return a.durationMinutes - b.durationMinutes;
        
        return new Date(a.createdAt) - new Date(b.createdAt);
      });
    }

    function MainApp() {
      const [meetings, setMeetings] = useState([]);
      const [topics, setTopics] = useState([]);
      const [selectedMeetingId, setSelectedMeetingId] = useState(null);
      const [showTopicModal, setShowTopicModal] = useState(false);
      const [showEditMeetingModal, setShowEditMeetingModal] = useState(false);
      const [showSettingsModal, setShowSettingsModal] = useState(false);
      const [isLoading, setIsLoading] = useState(true);
      const [isRegenerating, setIsRegenerating] = useState(false);
      const [isMobileSidebarOpen, setIsMobileSidebarOpen] = useState(false);
      const isInitializing = React.useRef(false);

      // Load meetings from Firestore on mount
      useEffect(() => {
        let hasDeduped = false;
        
        const unsubscribe = db.collection('meetings').onSnapshot(async snapshot => {
          if (snapshot.empty && !isRegenerating && !isInitializing.current) {
            isInitializing.current = true;
            console.log('No meetings found, generating initial set...');
            
            // Load settings and generate
            const settingsDoc = await db.collection('settings').doc('meetingSettings').get();
            const settings = settingsDoc.exists ? settingsDoc.data() : {};
            
            const defaultMeetings = generateMeetingsFromSettings(settings);
            console.log('Generated initial meetings:', defaultMeetings.length);
            
            // Add all in one go
            const addOps = defaultMeetings.map(meeting => {
              const { id, ...meetingData } = meeting;
              return db.collection('meetings').add(meetingData);
            });
            await Promise.all(addOps);
            console.log('Initial meetings added to database');
            
            isInitializing.current = false;
          } else if (!snapshot.empty) {
            const loadedMeetings = snapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
            
            // One-time deduplication check on first load
            if (!hasDeduped) {
              hasDeduped = true;
              const seenDateTimes = new Map();
              const duplicateIds = [];
              
              loadedMeetings.forEach(meeting => {
                const key = meeting.startDateTime;
                if (seenDateTimes.has(key)) {
                  duplicateIds.push(meeting.id);
                } else {
                  seenDateTimes.set(key, meeting.id);
                }
              });
              
              // Delete duplicates if found
              if (duplicateIds.length > 0) {
                console.log('Found duplicates, cleaning up:', duplicateIds.length);
                const cleanupBatch = db.batch();
                duplicateIds.forEach(id => {
                  cleanupBatch.delete(db.collection('meetings').doc(id));
                });
                await cleanupBatch.commit();
                return; // Let the snapshot fire again with clean data
              }
            }
            
            setMeetings(loadedMeetings.sort((a, b) => new Date(a.startDateTime) - new Date(b.startDateTime)));
            setIsLoading(false);
          }
        });
        
        return () => unsubscribe();
      }, [isRegenerating]);

      // Load topics from Firestore on mount
      useEffect(() => {
        const unsubscribe = db.collection('topics').onSnapshot(snapshot => {
          const loadedTopics = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data()
          }));
          setTopics(loadedTopics);
        });
        
        return () => unsubscribe();
      }, []);

      useEffect(() => {
        if (!selectedMeetingId && meetings.length > 0) {
          const now = new Date();
          const upcomingMeeting = meetings.find(m => new Date(m.startDateTime) >= now);
          setSelectedMeetingId(upcomingMeeting ? upcomingMeeting.id : meetings[0].id);
        }
      }, [meetings, selectedMeetingId]);

      const selectedMeeting = meetings.find(m => m.id === selectedMeetingId);
      const sortedTopics = useMemo(() => {
        const meetingTopics = topics.filter(t => t.meetingId === selectedMeetingId);
        return sortTopics(meetingTopics);
      }, [topics, selectedMeetingId]);

      const addTopic = async (topic) => {
        const newTopic = { 
          ...topic, 
          createdAt: new Date().toISOString(),
          meetingId: selectedMeetingId 
        };
        await db.collection('topics').add(newTopic);
      };

      const deleteTopic = async (topicId) => {
        await db.collection('topics').doc(topicId).delete();
      };

      const updateMeeting = async (meetingId, updates) => {
        try {
          await db.collection('meetings').doc(meetingId).update(updates);
        } catch (error) {
          console.error('Error updating meeting:', error);
          alert('Error updating meeting. Please try again.');
        }
      };

      if (isLoading) {
        return (
          <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', height: '100vh', fontSize: '18px', color: '#666' }}>
            Loading meetings...
          </div>
        );
      }

      return (
        <div className="app">
          {/* Mobile Menu Button */}
          <button 
            className="mobile-menu-btn"
            onClick={() => setIsMobileSidebarOpen(!isMobileSidebarOpen)}
            aria-label={isMobileSidebarOpen ? "Close menu" : "Open menu"}
          >
            {isMobileSidebarOpen ? (
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            ) : (
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
              </svg>
            )}
          </button>

          {/* Mobile Overlay */}
          <div 
            className={`mobile-overlay ${isMobileSidebarOpen ? 'open' : ''}`}
            onClick={() => setIsMobileSidebarOpen(false)}
          />

          <Sidebar 
            meetings={meetings} 
            selectedMeetingId={selectedMeetingId}
            onSelectMeeting={(id) => {
              setSelectedMeetingId(id);
              setIsMobileSidebarOpen(false); // Close sidebar on mobile when selecting
            }}
            onUpdateMeeting={updateMeeting}
            onOpenSettings={() => setShowSettingsModal(true)}
            isRegenerating={isRegenerating}
            isMobileOpen={isMobileSidebarOpen}
            onMobileClose={() => setIsMobileSidebarOpen(false)}
          />
          <Main 
            meeting={selectedMeeting}
            topics={sortedTopics}
            onAddTopic={() => setShowTopicModal(true)}
            onEditMeeting={() => setShowEditMeetingModal(true)}
            onDeleteTopic={deleteTopic}
          />
          {showTopicModal && (
            <TopicModal 
              onClose={() => setShowTopicModal(false)}
              onSave={addTopic}
            />
          )}
          {showEditMeetingModal && selectedMeeting && (
            <EditMeetingModal
              meeting={selectedMeeting}
              onClose={() => setShowEditMeetingModal(false)}
              onSave={(updates) => {
                updateMeeting(selectedMeeting.id, updates);
                setShowEditMeetingModal(false);
              }}
            />
          )}
          {showSettingsModal && (
            <SettingsModal
              onClose={() => setShowSettingsModal(false)}
              onSave={async (settings) => {
                try {
                  // Disable the modal and show loading
                  setIsRegenerating(true);
                  setIsLoading(true);
                  setShowSettingsModal(false); // Close modal immediately
                  
                  // Save settings to Firestore first
                  await db.collection('settings').doc('meetingSettings').set(settings);
                  
                  // Generate new meetings FIRST (before deleting old ones)
                  const newMeetings = generateMeetingsFromSettings(settings);
                  console.log('Generated new meetings:', newMeetings.length);
                  
                  // Get all existing meetings
                  const meetingsSnapshot = await db.collection('meetings').get();
                  console.log('Existing meetings in DB:', meetingsSnapshot.docs.length);
                  
                  // Use a single large batch operation to delete all and add all
                  // This makes it more atomic
                  const allOps = [];
                  
                  // Add all deletions
                  meetingsSnapshot.docs.forEach(doc => {
                    allOps.push(db.collection('meetings').doc(doc.id).delete());
                  });
                  
                  // Wait for all deletions to complete
                  await Promise.all(allOps);
                  console.log('Deleted all old meetings');
                  
                  // Small delay to ensure Firestore has processed deletions
                  await new Promise(resolve => setTimeout(resolve, 300));
                  
                  // Now add all new meetings
                  const addOps = [];
                  newMeetings.forEach(meeting => {
                    const { id, ...meetingData } = meeting;
                    addOps.push(db.collection('meetings').add(meetingData));
                  });
                  
                  await Promise.all(addOps);
                  console.log('Added all new meetings');
                  
                  // Clear both loading flags - the snapshot will fire with new data
                  setIsRegenerating(false);
                  setIsLoading(false);
                } catch (error) {
                  console.error('Error saving settings:', error);
                  alert('Error saving settings: ' + error.message);
                  setIsLoading(false);
                  setIsRegenerating(false);
                  setShowSettingsModal(true); // Reopen modal on error
                }
              }}
            />
          )}
        </div>
      );
    }

    function Sidebar({ meetings, selectedMeetingId, onSelectMeeting, onUpdateMeeting, onOpenSettings, isRegenerating, isMobileOpen, onMobileClose }) {
      const now = new Date();
      const [editingMeetingId, setEditingMeetingId] = React.useState(null);
      const [showPastMeetings, setShowPastMeetings] = React.useState(false);
      const [seriesName, setSeriesName] = React.useState('Design Studio Forum');

      // Load series name from Firestore
      React.useEffect(() => {
        const unsubscribe = db.collection('settings').doc('meetingSettings').onSnapshot(doc => {
          if (doc.exists && doc.data().seriesName) {
            setSeriesName(doc.data().seriesName);
          }
        });
        
        return () => unsubscribe();
      }, []);

      const futureMeetings = meetings.filter(m => new Date(m.startDateTime) >= now);
      const pastMeetings = meetings.filter(m => new Date(m.startDateTime) < now);

      return (
        <div className={`sidebar ${isMobileOpen ? 'open' : ''}`}>
          <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '16px' }}>
            <h2>{seriesName}</h2>
            <button
              onClick={() => onOpenSettings()}
              title="Meeting settings"
              style={{
                width: '28px',
                height: '28px',
                padding: 0,
                background: 'transparent',
                border: 'none',
                cursor: 'pointer',
                color: '#666',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                borderRadius: '6px'
              }}
              onMouseEnter={(e) => e.currentTarget.style.background = '#e8e8e8'}
              onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
            >
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
              </svg>
            </button>
          </div>
          
          {isRegenerating ? (
            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '80px 20px' }}>
              <div style={{
                width: '32px',
                height: '32px',
                border: '3px solid #e0e0e0',
                borderTop: '3px solid #333',
                borderRadius: '50%',
                animation: 'spin 0.8s linear infinite'
              }}></div>
              <style>{`
                @keyframes spin {
                  0% { transform: rotate(0deg); }
                  100% { transform: rotate(360deg); }
                }
              `}</style>
            </div>
          ) : (
            <>
          {futureMeetings.map(meeting => {
            const start = new Date(meeting.startDateTime);

            return (
              <div
                key={meeting.id}
                className={`meeting-item ${selectedMeetingId === meeting.id ? 'selected' : ''}`}
                onClick={() => onSelectMeeting(meeting.id)}
              >
                <div className="meeting-date">
                  {start.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
                </div>
                <div className="meeting-time">
                  {start.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', timeZone: 'America/Los_Angeles' })} - 
                  {new Date(meeting.endDateTime).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', timeZone: 'America/Los_Angeles' })}
                </div>
                <button 
                  className="meeting-edit-btn"
                  onClick={(e) => {
                    e.stopPropagation();
                    setEditingMeetingId(meeting.id);
                  }}
                  title="Edit meeting time"
                >
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                  </svg>
                </button>
              </div>
            );
          })}

          {pastMeetings.length > 0 && (
            <>
              <div 
                className="past-meetings-toggle"
                onClick={() => setShowPastMeetings(!showPastMeetings)}
              >
                <span>Past Meetings ({pastMeetings.length})</span>
                <span style={{ fontSize: '12px' }}>{showPastMeetings ? '▲' : '▼'}</span>
              </div>

              {showPastMeetings && pastMeetings.map(meeting => {
                const start = new Date(meeting.startDateTime);

                return (
                  <div
                    key={meeting.id}
                    className={`meeting-item past ${selectedMeetingId === meeting.id ? 'selected' : ''}`}
                    onClick={() => onSelectMeeting(meeting.id)}
                  >
                    <div className="meeting-date">
                      {start.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
                    </div>
                    <div className="meeting-time">
                      {start.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', timeZone: 'America/Los_Angeles' })} - 
                      {new Date(meeting.endDateTime).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', timeZone: 'America/Los_Angeles' })}
                    </div>
                  </div>
                );
              })}
            </>
          )}

          {editingMeetingId && meetings.find(m => m.id === editingMeetingId) && (
            <EditMeetingModal
              meeting={meetings.find(m => m.id === editingMeetingId)}
              onClose={() => setEditingMeetingId(null)}
              onSave={(updates) => {
                onUpdateMeeting(editingMeetingId, updates);
                setEditingMeetingId(null);
              }}
            />
          )}
        </>
      )}
        </div>
      );
    }

    function Main({ meeting, topics, onAddTopic, onEditMeeting, onDeleteTopic }) {
      const [isHeaderHovered, setIsHeaderHovered] = React.useState(false);

      if (!meeting) {
        return <div className="main"><div className="empty-state">Select a meeting</div></div>;
      }

      const start = new Date(meeting.startDateTime);
      const isPast = start < new Date();

      return (
        <div className="main">
          <div className="header">
            <div 
              className="header-title-row"
              onMouseEnter={() => setIsHeaderHovered(true)}
              onMouseLeave={() => setIsHeaderHovered(false)}
            >
              <h1>
                {start.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}
              </h1>
              {!isPast && (
                <button 
                  className="header-edit-btn"
                  onClick={onEditMeeting}
                  title="Edit meeting time"
                >
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                  </svg>
                </button>
              )}
            </div>
            <div style={{ fontSize: '14px', color: '#666', marginBottom: '4px' }}>
              {start.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', timeZone: 'America/Los_Angeles' })} - 
              {new Date(meeting.endDateTime).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', timeZone: 'America/Los_Angeles' })}
            </div>
            {isPast && <div style={{ fontSize: '13px', color: '#999' }}>Past meeting</div>}
            {!isPast && (
              <div className="header-actions">
                <button onClick={onAddTopic}>Add Topic</button>
              </div>
            )}
          </div>

          {topics.length === 0 ? (
            <div className="empty-state">{isPast ? 'No topics.' : 'No topics yet. Add one to get started.'}</div>
          ) : (
            topics.map(topic => <TopicCard key={topic.id} topic={topic} onDelete={onDeleteTopic} isPast={isPast} />)
          )}
        </div>
      );
    }

    function DeleteConfirmModal({ onClose, onConfirm, itemName }) {
      return (
        <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 2000 }}>
          <div onClick={e => e.stopPropagation()} style={{ background: '#fff', padding: '32px', borderRadius: '12px', maxWidth: '400px', width: '90%' }}>
            <h2 style={{ fontSize: '18px', marginBottom: '16px', fontWeight: 700 }}>Delete Topic</h2>
            <p style={{ marginBottom: '24px', color: '#555', lineHeight: 1.5 }}>
              Are you sure you want to delete this topic? This action cannot be undone.
            </p>
            <div style={{ display: 'flex', gap: '12px', justifyContent: 'flex-end' }}>
              <button onClick={onClose} style={{ padding: '10px 20px', background: '#fff', color: '#333', border: '1px solid #e0e0e0', borderRadius: '8px', cursor: 'pointer', fontSize: '14px' }}>Cancel</button>
              <button onClick={onConfirm} style={{ padding: '10px 20px', background: '#ff4444', color: '#fff', border: 'none', borderRadius: '8px', cursor: 'pointer', fontSize: '14px' }}>Delete</button>
            </div>
          </div>
        </div>
      );
    }

    function TopicCard({ topic, onDelete, isPast }) {
      const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
      const [isHovered, setIsHovered] = useState(false);
      
      return (
        <>
        <div 
          className="topic-card"
          onMouseEnter={() => setIsHovered(true)}
          onMouseLeave={() => setIsHovered(false)}
        >
          {!isPast && (
            <button
              onClick={() => setShowDeleteConfirm(true)}
              title="Delete topic"
              style={{
                position: 'absolute',
                top: '16px',
                right: '16px',
                width: '24px',
                height: '24px',
                padding: 0,
                background: 'transparent',
                border: 'none',
                cursor: 'pointer',
                color: '#666',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                opacity: isHovered ? 1 : 0,
                transition: 'opacity 0.2s, background 0.2s',
                borderRadius: '6px'
              }}
              className="topic-delete-btn"
              onMouseEnter={(e) => e.currentTarget.style.background = '#e8e8e8'}
              onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
            >
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
              </svg>
            </button>
          )}
          <div className="topic-header">
            <div style={{ flex: 1 }}>
              <strong>{topic.presenterName}</strong>
            </div>
          </div>
          <div className="topic-meta">
            <span className="badge" style={{ 
              background: topic.urgency === 5 ? '#FFE2E3' : topic.urgency === 4 ? '#FFEDDB' : topic.urgency === 3 ? '#EADFFF' : '#DFEDFF',
              color: topic.urgency === 5 ? '#C90009' : topic.urgency === 4 ? '#AD5500' : topic.urgency === 3 ? '#4301C1' : '#0053C0',
              border: 'none',
              fontWeight: 600,
              display: 'inline-flex',
              alignItems: 'center'
            }}>
              {URGENCY_LEVELS.find(l => l.value === topic.urgency)?.label}
            </span>
            <span className="badge" style={{ display: 'inline-flex', alignItems: 'center' }}>{TOPIC_TYPES[topic.type].label}</span>
            <span className="badge" style={{ display: 'inline-flex', alignItems: 'center', gap: '4px' }}>
              <svg width="12" height="12" viewBox="0 0 24 24" fill="#666">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 6v6l4 2" stroke="#fff" strokeWidth="2" strokeLinecap="round"/>
              </svg>
              {topic.durationMinutes} min
            </span>
          </div>
          <div className="topic-description">{topic.description}</div>
          {(topic.fileLink || (topic.fileLinks && topic.fileLinks.length > 0)) && (
            <div className="file-links">
              <strong>Link:</strong>{' '}
              {topic.fileLink ? (
                <a href={topic.fileLink} target="_blank" rel="noopener noreferrer">{topic.fileLink}</a>
              ) : (
                topic.fileLinks.map((link, i) => (
                  <a key={i} href={link} target="_blank" rel="noopener noreferrer" style={{ marginRight: '12px' }}>{link}</a>
                ))
              )}
            </div>
          )}
        </div>
        {showDeleteConfirm && (
          <DeleteConfirmModal
            onClose={() => setShowDeleteConfirm(false)}
            onConfirm={() => {
              onDelete(topic.id);
              setShowDeleteConfirm(false);
            }}
            itemName={topic.presenterName}
          />
        )}
        </>
      );
    }

    function TopicModal({ onClose, onSave }) {
      const [formData, setFormData] = useState({
        presenterName: '',
        type: 'QUESTION',
        description: '',
        durationMinutes: 5,
        urgency: 3,
        fileLink: ''
      });

      const handleSubmit = (e) => {
        e.preventDefault();
        onSave(formData);
        onClose();
      };

      return (
        <div className="modal-overlay">
          <div className="modal" onClick={e => e.stopPropagation()}>
            <h2>Add Topic</h2>
            <form onSubmit={handleSubmit}>
              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px', marginBottom: '20px' }}>
                <div className="form-group" style={{ marginBottom: 0 }}>
                  <label>Presenter Name *</label>
                  <input
                    required
                    value={formData.presenterName}
                    onChange={e => setFormData({ ...formData, presenterName: e.target.value })}
                  />
                </div>

                <div className="form-group" style={{ marginBottom: 0 }}>
                  <label>Type *</label>
                  <select
                    value={formData.type}
                    onChange={e => setFormData({ ...formData, type: e.target.value })}
                  >
                    {Object.entries(TOPIC_TYPES).map(([key, { label }]) => (
                      <option key={key} value={key}>{label}</option>
                    ))}
                  </select>
                </div>
              </div>

              <div className="form-group">
                <label>Description *</label>
                <textarea
                  required
                  value={formData.description}
                  onChange={e => setFormData({ ...formData, description: e.target.value })}
                />
              </div>

              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px', marginBottom: '20px' }}>
                <div className="form-group" style={{ marginBottom: 0 }}>
                  <label>Duration (minutes) *</label>
                  <input
                    type="number"
                    required
                    min="1"
                    value={formData.durationMinutes}
                    onChange={e => setFormData({ ...formData, durationMinutes: parseInt(e.target.value) })}
                  />
                </div>

                <div className="form-group" style={{ marginBottom: 0 }}>
                  <label>Urgency *</label>
                  <select
                    value={formData.urgency}
                    onChange={e => setFormData({ ...formData, urgency: parseInt(e.target.value) })}
                  >
                    {URGENCY_LEVELS.map(level => (
                      <option key={level.value} value={level.value}>{level.label}</option>
                    ))}
                  </select>
                </div>
              </div>

              <div className="form-group">
                <label>File Link (optional)</label>
                <input
                  type="url"
                  placeholder="https://..."
                  value={formData.fileLink}
                  onChange={e => setFormData({ ...formData, fileLink: e.target.value })}
                />
              </div>

              <div className="modal-actions">
                <button type="button" className="secondary" onClick={onClose}>Cancel</button>
                <button type="submit">Add Topic</button>
              </div>
            </form>
          </div>
        </div>
      );
    }

    function DateTimePicker({ value, onChange, onClose }) {
      const [selectedDate, setSelectedDate] = useState(new Date(value));
      const [currentMonth, setCurrentMonth] = useState(new Date(value));

      const hours = Array.from({length: 12}, (_, i) => String(i + 1).padStart(2, '0'));
      const minutes = Array.from({length: 60}, (_, i) => String(i).padStart(2, '0'));

      const hour = selectedDate.getHours();
      const minute = selectedDate.getMinutes();
      const displayHour = hour % 12 || 12;
      const ampm = hour >= 12 ? 'PM' : 'AM';

      const getDaysInMonth = (date) => {
        const year = date.getFullYear();
        const month = date.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDayOfWeek = firstDay.getDay();
        
        const days = [];
        // Add previous month's trailing days
        for (let i = 0; i < startingDayOfWeek; i++) {
          const prevMonthDay = new Date(year, month, -startingDayOfWeek + i + 1);
          days.push({ date: prevMonthDay, isCurrentMonth: false });
        }
        // Add current month's days
        for (let i = 1; i <= daysInMonth; i++) {
          days.push({ date: new Date(year, month, i), isCurrentMonth: true });
        }
        // Add next month's days to complete the last week only
        const remainingDays = (7 - (days.length % 7)) % 7;
        for (let i = 1; i <= remainingDays; i++) {
          days.push({ date: new Date(year, month + 1, i), isCurrentMonth: false });
        }
        return days;
      };

      const days = getDaysInMonth(currentMonth);
      const monthYear = currentMonth.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

      const isSameDay = (date1, date2) => {
        return date1.getDate() === date2.getDate() &&
               date1.getMonth() === date2.getMonth() &&
               date1.getFullYear() === date2.getFullYear();
      };

      const handleDateClick = (date) => {
        const newDate = new Date(selectedDate);
        newDate.setFullYear(date.getFullYear());
        newDate.setMonth(date.getMonth());
        newDate.setDate(date.getDate());
        setSelectedDate(newDate);
        onChange(newDate);
      };

      const handleTimeChange = (type, value) => {
        const newDate = new Date(selectedDate);
        if (type === 'hour') {
          const numValue = parseInt(value);
          const currentHour = newDate.getHours();
          const isPM = currentHour >= 12;
          const newHour = isPM ? (numValue === 12 ? 12 : numValue + 12) : (numValue === 12 ? 0 : numValue);
          newDate.setHours(newHour);
        } else if (type === 'minute') {
          newDate.setMinutes(parseInt(value));
        } else if (type === 'ampm') {
          const currentHour = newDate.getHours();
          if (value === 'AM' && currentHour >= 12) {
            newDate.setHours(currentHour - 12);
          } else if (value === 'PM' && currentHour < 12) {
            newDate.setHours(currentHour + 12);
          }
        }
        setSelectedDate(newDate);
        onChange(newDate);
      };

      return (
        <div style={{ background: '#fff', borderRadius: '12px', padding: '20px', width: '360px', boxShadow: '0 4px 12px rgba(0,0,0,0.15)' }}>
          <div style={{ marginBottom: '16px' }}>
            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '12px' }}>
              <span style={{ fontSize: '16px', fontWeight: 600 }}>{monthYear}</span>
              <div style={{ display: 'flex', gap: '8px' }}>
                <button type="button" onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1))} style={{ padding: '4px 8px', background: 'transparent', border: 'none', cursor: 'pointer', fontSize: '18px', color: '#333' }}>‹</button>
                <button type="button" onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1))} style={{ padding: '4px 8px', background: 'transparent', border: 'none', cursor: 'pointer', fontSize: '18px', color: '#333' }}>›</button>
              </div>
            </div>
            
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '4px', marginBottom: '8px' }}>
              {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                <div key={day} style={{ textAlign: 'center', fontSize: '12px', fontWeight: 500, color: '#999', padding: '4px' }}>{day}</div>
              ))}
            </div>
            
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '4px' }}>
              {days.map((day, i) => (
                <button
                  type="button"
                  key={i}
                  onClick={() => handleDateClick(day.date)}
                  style={{
                    width: '36px',
                    height: '36px',
                    padding: 0,
                    background: isSameDay(day.date, selectedDate) ? '#333' : 'transparent',
                    border: 'none',
                    borderRadius: '50%',
                    cursor: 'pointer',
                    fontSize: '14px',
                    color: !day.isCurrentMonth ? '#ccc' : isSameDay(day.date, selectedDate) ? '#fff' : '#333',
                    fontWeight: isSameDay(day.date, selectedDate) ? 600 : 400,
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center'
                  }}
                >
                  {day.date.getDate()}
                </button>
              ))}
            </div>
          </div>

          <div style={{ borderTop: '1px solid #e0e0e0', paddingTop: '16px' }}>
            <div style={{ display: 'flex', gap: '8px', alignItems: 'center' }}>
              <select value={String(displayHour).padStart(2, '0')} onChange={(e) => handleTimeChange('hour', e.target.value)} style={{ padding: '8px 12px', paddingRight: '36px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', flex: 1, appearance: 'none', backgroundImage: "url(\"data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 12 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 4L6 8L10 4' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E\")", backgroundRepeat: 'no-repeat', backgroundPosition: 'right 12px center' }}>
                {hours.map(h => <option key={h} value={h}>{h}</option>)}
              </select>
              <span style={{ fontSize: '18px', fontWeight: 600 }}>:</span>
              <select value={String(minute).padStart(2, '0')} onChange={(e) => handleTimeChange('minute', e.target.value)} style={{ padding: '8px 12px', paddingRight: '36px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', flex: 1, appearance: 'none', backgroundImage: "url(\"data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 12 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 4L6 8L10 4' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E\")", backgroundRepeat: 'no-repeat', backgroundPosition: 'right 12px center' }}>
                {minutes.map(m => <option key={m} value={m}>{m}</option>)}
              </select>
              <select value={ampm} onChange={(e) => handleTimeChange('ampm', e.target.value)} style={{ padding: '8px 12px', paddingRight: '36px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', flex: 1, appearance: 'none', backgroundImage: "url(\"data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 12 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 4L6 8L10 4' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E\")", backgroundRepeat: 'no-repeat', backgroundPosition: 'right 12px center' }}>
                <option value="AM">AM</option>
                <option value="PM">PM</option>
              </select>
            </div>
          </div>
        </div>
      );
    }

        function DateOnlyPicker({ value, onChange }) {
      const [selectedDate, setSelectedDate] = useState(new Date(value));
      const [currentMonth, setCurrentMonth] = useState(new Date(value));

      const getDaysInMonth = (date) => {
        const year = date.getFullYear();
        const month = date.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDayOfWeek = firstDay.getDay();
        
        const days = [];
        for (let i = 0; i < startingDayOfWeek; i++) {
          const prevMonthDay = new Date(year, month, -startingDayOfWeek + i + 1);
          days.push({ date: prevMonthDay, isCurrentMonth: false });
        }
        for (let i = 1; i <= daysInMonth; i++) {
          days.push({ date: new Date(year, month, i), isCurrentMonth: true });
        }
        const remainingDays = (7 - (days.length % 7)) % 7;
        for (let i = 1; i <= remainingDays; i++) {
          days.push({ date: new Date(year, month + 1, i), isCurrentMonth: false });
        }
        return days;
      };

      const days = getDaysInMonth(currentMonth);
      const monthYear = currentMonth.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

      const isSameDay = (date1, date2) => {
        return date1.getDate() === date2.getDate() &&
               date1.getMonth() === date2.getMonth() &&
               date1.getFullYear() === date2.getFullYear();
      };

      const handleDateClick = (date) => {
        const newDate = new Date(date);
        newDate.setHours(0, 0, 0, 0);
        setSelectedDate(newDate);
        onChange(newDate);
        // Parent component handles closing via setShowStartDatePicker/setShowEndDatePicker
      };

      return (
        <div style={{ background: '#fff', borderRadius: '12px', padding: '20px', width: '360px', boxShadow: '0 4px 12px rgba(0,0,0,0.15)' }}>
          <div style={{ marginBottom: '16px' }}>
            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '12px' }}>
              <span style={{ fontSize: '16px', fontWeight: 600 }}>{monthYear}</span>
              <div style={{ display: 'flex', gap: '8px' }}>
                <button type="button" onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1))} style={{ padding: '4px 8px', background: 'transparent', border: 'none', cursor: 'pointer', fontSize: '18px', color: '#333' }}>‹</button>
                <button type="button" onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1))} style={{ padding: '4px 8px', background: 'transparent', border: 'none', cursor: 'pointer', fontSize: '18px', color: '#333' }}>›</button>
              </div>
            </div>
            
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '4px', marginBottom: '8px' }}>
              {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                <div key={day} style={{ textAlign: 'center', fontSize: '12px', fontWeight: 500, color: '#999', padding: '4px' }}>{day}</div>
              ))}
            </div>
            
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '4px' }}>
              {days.map((day, i) => (
                <button
                  type="button"
                  key={i}
                  onClick={() => handleDateClick(day.date)}
                  style={{
                    width: '36px',
                    height: '36px',
                    padding: 0,
                    background: isSameDay(day.date, selectedDate) ? '#333' : 'transparent',
                    border: 'none',
                    borderRadius: '50%',
                    cursor: 'pointer',
                    fontSize: '14px',
                    color: !day.isCurrentMonth ? '#ccc' : isSameDay(day.date, selectedDate) ? '#fff' : '#333',
                    fontWeight: isSameDay(day.date, selectedDate) ? 600 : 400,
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center'
                  }}
                >
                  {day.date.getDate()}
                </button>
              ))}
            </div>
          </div>
        </div>
      );
    }


        function SettingsModal({ onClose, onSave }) {
      const [formData, setFormData] = useState({
        seriesName: 'Design Studio Forum',
        startDate: '2026-01-08T00:00:00-08:00',
        endDate: '2026-12-31T00:00:00-08:00',
        daysOfWeek: [4],
        startHour: 1,
        startMinute: 0,
        startAmPm: 'PM',
        endHour: 1,
        endMinute: 45,
        endAmPm: 'PM',
        frequency: 'weekly',
        interval: 1
      });

      // Load settings from Firestore
      useEffect(() => {
        db.collection('settings').doc('meetingSettings').get().then(doc => {
          if (doc.exists) {
            setFormData(prevData => ({
              ...prevData,
              ...doc.data()
            }));
          }
        });
      }, []);

      const [showStartDatePicker, setShowStartDatePicker] = useState(false);
      const [showEndDatePicker, setShowEndDatePicker] = useState(false);
      const [isSaving, setIsSaving] = useState(false);

      const handleSubmit = async (e) => {
        e.preventDefault();
        setIsSaving(true);
        try {
          await onSave(formData);
        } catch (error) {
          console.error('Save error:', error);
        } finally {
          setIsSaving(false);
        }
      };

      const toggleDayOfWeek = (day) => {
        const currentDays = formData.daysOfWeek;
        if (currentDays.includes(day)) {
          setFormData({ ...formData, daysOfWeek: currentDays.filter(d => d !== day) });
        } else {
          setFormData({ ...formData, daysOfWeek: [...currentDays, day].sort() });
        }
      };

      const formatDateOnly = (dateStr) => {
        if (!dateStr) return 'Select date';
        const date = new Date(dateStr);
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric', timeZone: 'America/Los_Angeles' });
      };

      const getIntervalUnit = () => {
        if (formData.frequency === 'daily') return 'day(s)';
        if (formData.frequency === 'weekly') return 'week(s)';
        if (formData.frequency === 'monthly') return 'month(s)';
        return 'week(s)';
      };

      const hours = Array.from({length: 12}, (_, i) => String(i + 1).padStart(2, '0'));
      const minutes = Array.from({length: 60}, (_, i) => String(i).padStart(2, '0'));
      const daysOfWeek = [
        { value: 0, label: 'S', full: 'Sunday' },
        { value: 1, label: 'M', full: 'Monday' },
        { value: 2, label: 'T', full: 'Tuesday' },
        { value: 3, label: 'W', full: 'Wednesday' },
        { value: 4, label: 'T', full: 'Thursday' },
        { value: 5, label: 'F', full: 'Friday' },
        { value: 6, label: 'S', full: 'Saturday' }
      ];

      return (
        <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000 }}>
          <div className="settings-modal" onClick={e => e.stopPropagation()} style={{ background: '#fff', padding: '32px', borderRadius: '12px', maxWidth: '600px', width: '90%', maxHeight: '90vh', overflowY: 'auto', overflowX: 'visible', position: 'relative' }}>
            <h2 style={{ fontSize: '24px', marginBottom: '32px', fontWeight: 700 }}>Edit Meeting Series</h2>
            <form onSubmit={handleSubmit}>
              {/* Series Name */}
              <div style={{ marginBottom: '32px' }}>
                <label style={{ display: 'block', fontSize: '14px', fontWeight: 500, marginBottom: '8px', color: '#555' }}>Series Name</label>
                <input 
                  required 
                  value={formData.seriesName} 
                  onChange={e => setFormData({ ...formData, seriesName: e.target.value })} 
                  style={{ width: '100%', padding: '12px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', outline: 'none' }}
                  onFocus={(e) => { e.target.style.borderColor = '#333'; e.target.style.boxShadow = '0 0 0 3px rgba(51, 51, 51, 0.1)'; }}
                  onBlur={(e) => { e.target.style.borderColor = '#e0e0e0'; e.target.style.boxShadow = 'none'; }}
                />
              </div>

              {/* DATE & TIME Section */}
              <div style={{ marginBottom: '32px' }}>
                <h3 style={{ fontSize: '12px', fontWeight: 600, color: '#999', letterSpacing: '0.5px', marginBottom: '16px' }}>DATE & TIME</h3>
                
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px', marginBottom: '16px' }}>
                  <div style={{ position: 'relative' }}>
                    <label style={{ display: 'block', fontSize: '14px', fontWeight: 500, marginBottom: '8px', color: '#555' }}>Start Date</label>
                    <button
                      type="button"
                      className="custom-date-button"
                      onClick={() => {
                        setShowStartDatePicker(!showStartDatePicker);
                        setShowEndDatePicker(false);
                      }}
                      style={{ width: '100%', padding: '12px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', textAlign: 'left', background: '#fff', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'space-between', outline: 'none', color: '#333' }}
                      onFocus={(e) => { e.target.style.borderColor = '#333'; e.target.style.boxShadow = '0 0 0 3px rgba(51, 51, 51, 0.1)'; }}
                      onBlur={(e) => { e.target.style.borderColor = '#e0e0e0'; e.target.style.boxShadow = 'none'; }}
                    >
                      <span style={{ flex: 1 }}>{formatDateOnly(formData.startDate)}</span>
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="#666">
                        <path d="M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 18H4V8h16v13z"/>
                      </svg>
                    </button>
                    <input
                      type="date"
                      className="native-date-input"
                      value={formData.startDate ? formData.startDate.split('T')[0] : ''}
                      onChange={(e) => {
                        if (e.target.value) {
                          const date = new Date(e.target.value + 'T00:00:00');
                          setFormData({ ...formData, startDate: dateToLocalString(date) });
                        }
                      }}
                      style={{ width: '100%', padding: '12px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', outline: 'none' }}
                      onFocus={(e) => { e.target.style.borderColor = '#333'; e.target.style.boxShadow = '0 0 0 3px rgba(51, 51, 51, 0.1)'; }}
                      onBlur={(e) => { e.target.style.borderColor = '#e0e0e0'; e.target.style.boxShadow = 'none'; }}
                    />
                    {showStartDatePicker && (
                      <>
                        <div 
                          style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, zIndex: 1000 }}
                          onClick={() => setShowStartDatePicker(false)}
                        />
                        <div style={{ position: 'absolute', top: '100%', left: 0, zIndex: 1001, marginTop: '8px' }}>
                          <DateOnlyPicker
                            value={formData.startDate}
                            onChange={(date) => {
                              setFormData({ ...formData, startDate: dateToLocalString(date) });
                              setShowStartDatePicker(false);
                            }}
                          />
                        </div>
                      </>
                    )}
                  </div>
                  <div style={{ position: 'relative' }}>
                    <label style={{ display: 'block', fontSize: '14px', fontWeight: 500, marginBottom: '8px', color: '#555' }}>End Date</label>
                    <button
                      type="button"
                      className="custom-date-button"
                      onClick={() => {
                        setShowEndDatePicker(!showEndDatePicker);
                        setShowStartDatePicker(false);
                      }}
                      style={{ width: '100%', padding: '12px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', textAlign: 'left', background: '#fff', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'space-between', outline: 'none', color: '#333' }}
                      onFocus={(e) => { e.target.style.borderColor = '#333'; e.target.style.boxShadow = '0 0 0 3px rgba(51, 51, 51, 0.1)'; }}
                      onBlur={(e) => { e.target.style.borderColor = '#e0e0e0'; e.target.style.boxShadow = 'none'; }}
                    >
                      <span style={{ flex: 1 }}>{formatDateOnly(formData.endDate)}</span>
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="#666">
                        <path d="M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 18H4V8h16v13z"/>
                      </svg>
                    </button>
                    <input
                      type="date"
                      className="native-date-input"
                      value={formData.endDate ? formData.endDate.split('T')[0] : ''}
                      onChange={(e) => {
                        if (e.target.value) {
                          const date = new Date(e.target.value + 'T00:00:00');
                          setFormData({ ...formData, endDate: dateToLocalString(date) });
                        }
                      }}
                      style={{ width: '100%', padding: '12px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', outline: 'none' }}
                      onFocus={(e) => { e.target.style.borderColor = '#333'; e.target.style.boxShadow = '0 0 0 3px rgba(51, 51, 51, 0.1)'; }}
                      onBlur={(e) => { e.target.style.borderColor = '#e0e0e0'; e.target.style.boxShadow = 'none'; }}
                    />
                    {showEndDatePicker && (
                      <>
                        <div 
                          style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, zIndex: 1000 }}
                          onClick={() => setShowEndDatePicker(false)}
                        />
                        <div style={{ position: 'absolute', top: '100%', right: 0, zIndex: 1001, marginTop: '8px' }}>
                          <DateOnlyPicker
                            value={formData.endDate}
                            onChange={(date) => {
                              setFormData({ ...formData, endDate: dateToLocalString(date) });
                              setShowEndDatePicker(false);
                            }}
                          />
                        </div>
                      </>
                    )}
                  </div>
                </div>

                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px' }}>
                  <div>
                    <label style={{ display: 'block', fontSize: '14px', fontWeight: 500, marginBottom: '8px', color: '#555' }}>Start Time</label>
                    <div style={{ display: 'flex', gap: '6px', alignItems: 'center' }}>
                      <select 
                        value={String(formData.startHour).padStart(2, '0')} 
                        onChange={e => setFormData({ ...formData, startHour: parseInt(e.target.value) })} 
                        style={{ padding: '10px', paddingRight: '32px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', flex: 1, appearance: 'none', backgroundImage: "url(\"data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 12 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 4L6 8L10 4' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E\")", backgroundRepeat: 'no-repeat', backgroundPosition: 'right 10px center', outline: 'none' }}
                        onFocus={(e) => { e.target.style.borderColor = '#333'; e.target.style.boxShadow = '0 0 0 3px rgba(51, 51, 51, 0.1)'; }}
                        onBlur={(e) => { e.target.style.borderColor = '#e0e0e0'; e.target.style.boxShadow = 'none'; }}
                      >
                        {hours.map(h => <option key={h} value={h}>{h}</option>)}
                      </select>
                      <span style={{ fontSize: '16px', fontWeight: 600 }}>:</span>
                      <select 
                        value={String(formData.startMinute).padStart(2, '0')} 
                        onChange={e => setFormData({ ...formData, startMinute: parseInt(e.target.value) })} 
                        style={{ padding: '10px', paddingRight: '32px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', flex: 1, appearance: 'none', backgroundImage: "url(\"data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 12 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 4L6 8L10 4' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E\")", backgroundRepeat: 'no-repeat', backgroundPosition: 'right 10px center', outline: 'none' }}
                        onFocus={(e) => { e.target.style.borderColor = '#333'; e.target.style.boxShadow = '0 0 0 3px rgba(51, 51, 51, 0.1)'; }}
                        onBlur={(e) => { e.target.style.borderColor = '#e0e0e0'; e.target.style.boxShadow = 'none'; }}
                      >
                        {minutes.map(m => <option key={m} value={m}>{m}</option>)}
                      </select>
                      <select 
                        value={formData.startAmPm} 
                        onChange={e => setFormData({ ...formData, startAmPm: e.target.value })} 
                        style={{ padding: '10px', paddingRight: '32px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', width: '85px', appearance: 'none', backgroundImage: "url(\"data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 12 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 4L6 8L10 4' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E\")", backgroundRepeat: 'no-repeat', backgroundPosition: 'right 10px center', outline: 'none' }}
                        onFocus={(e) => { e.target.style.borderColor = '#333'; e.target.style.boxShadow = '0 0 0 3px rgba(51, 51, 51, 0.1)'; }}
                        onBlur={(e) => { e.target.style.borderColor = '#e0e0e0'; e.target.style.boxShadow = 'none'; }}
                      >
                        <option value="AM">AM</option>
                        <option value="PM">PM</option>
                      </select>
                    </div>
                  </div>

                  <div>
                    <label style={{ display: 'block', fontSize: '14px', fontWeight: 500, marginBottom: '8px', color: '#555' }}>End Time</label>
                    <div style={{ display: 'flex', gap: '6px', alignItems: 'center' }}>
                      <select 
                        value={String(formData.endHour).padStart(2, '0')} 
                        onChange={e => setFormData({ ...formData, endHour: parseInt(e.target.value) })} 
                        style={{ padding: '10px', paddingRight: '32px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', flex: 1, appearance: 'none', backgroundImage: "url(\"data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 12 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 4L6 8L10 4' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E\")", backgroundRepeat: 'no-repeat', backgroundPosition: 'right 10px center', outline: 'none' }}
                        onFocus={(e) => { e.target.style.borderColor = '#333'; e.target.style.boxShadow = '0 0 0 3px rgba(51, 51, 51, 0.1)'; }}
                        onBlur={(e) => { e.target.style.borderColor = '#e0e0e0'; e.target.style.boxShadow = 'none'; }}
                      >
                        {hours.map(h => <option key={h} value={h}>{h}</option>)}
                      </select>
                      <span style={{ fontSize: '16px', fontWeight: 600 }}>:</span>
                      <select 
                        value={String(formData.endMinute).padStart(2, '0')} 
                        onChange={e => setFormData({ ...formData, endMinute: parseInt(e.target.value) })} 
                        style={{ padding: '10px', paddingRight: '32px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', flex: 1, appearance: 'none', backgroundImage: "url(\"data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 12 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 4L6 8L10 4' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E\")", backgroundRepeat: 'no-repeat', backgroundPosition: 'right 10px center', outline: 'none' }}
                        onFocus={(e) => { e.target.style.borderColor = '#333'; e.target.style.boxShadow = '0 0 0 3px rgba(51, 51, 51, 0.1)'; }}
                        onBlur={(e) => { e.target.style.borderColor = '#e0e0e0'; e.target.style.boxShadow = 'none'; }}
                      >
                        {minutes.map(m => <option key={m} value={m}>{m}</option>)}
                      </select>
                      <select 
                        value={formData.endAmPm} 
                        onChange={e => setFormData({ ...formData, endAmPm: e.target.value })} 
                        style={{ padding: '10px', paddingRight: '32px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', width: '85px', appearance: 'none', backgroundImage: "url(\"data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 12 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 4L6 8L10 4' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E\")", backgroundRepeat: 'no-repeat', backgroundPosition: 'right 10px center', outline: 'none' }}
                        onFocus={(e) => { e.target.style.borderColor = '#333'; e.target.style.boxShadow = '0 0 0 3px rgba(51, 51, 51, 0.1)'; }}
                        onBlur={(e) => { e.target.style.borderColor = '#e0e0e0'; e.target.style.boxShadow = 'none'; }}
                      >
                        <option value="AM">AM</option>
                        <option value="PM">PM</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              {/* RECURRENCE PATTERN Section */}
              <div style={{ marginBottom: '32px' }}>
                <h3 style={{ fontSize: '12px', fontWeight: 600, color: '#999', letterSpacing: '0.5px', marginBottom: '16px' }}>RECURRENCE PATTERN</h3>
                
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px', marginBottom: '16px' }}>
                  <div>
                    <label style={{ display: 'block', fontSize: '14px', fontWeight: 500, marginBottom: '8px', color: '#555' }}>Repeat</label>
                    <select 
                      value={formData.frequency} 
                      onChange={e => setFormData({ ...formData, frequency: e.target.value })} 
                      style={{ width: '100%', padding: '12px', paddingRight: '36px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', appearance: 'none', backgroundImage: "url(\"data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 12 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 4L6 8L10 4' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E\")", backgroundRepeat: 'no-repeat', backgroundPosition: 'right 12px center', outline: 'none' }}
                      onFocus={(e) => { e.target.style.borderColor = '#333'; e.target.style.boxShadow = '0 0 0 3px rgba(51, 51, 51, 0.1)'; }}
                      onBlur={(e) => { e.target.style.borderColor = '#e0e0e0'; e.target.style.boxShadow = 'none'; }}
                    >
                      <option value="daily">Daily</option>
                      <option value="weekly">Weekly</option>
                      <option value="monthly">Monthly</option>
                    </select>
                  </div>
                  <div>
                    <label style={{ display: 'block', fontSize: '14px', fontWeight: 500, marginBottom: '8px', color: '#555' }}>Every</label>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                      <input 
                        type="number" 
                        min="1" 
                        value={formData.interval} 
                        onChange={e => setFormData({ ...formData, interval: parseInt(e.target.value) })} 
                        style={{ width: '60px', padding: '12px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', outline: 'none', textAlign: 'center' }}
                        onFocus={(e) => { e.target.style.borderColor = '#333'; e.target.style.boxShadow = '0 0 0 3px rgba(51, 51, 51, 0.1)'; }}
                        onBlur={(e) => { e.target.style.borderColor = '#e0e0e0'; e.target.style.boxShadow = 'none'; }}
                      />
                      <span style={{ fontSize: '14px', color: '#999' }}>{getIntervalUnit()}</span>
                    </div>
                  </div>
                </div>

                {formData.frequency === 'weekly' && (
                  <div>
                    <label style={{ display: 'block', fontSize: '14px', fontWeight: 500, marginBottom: '8px', color: '#555' }}>Repeats On</label>
                    <div style={{ display: 'flex', gap: '8px' }}>
                      {daysOfWeek.map(day => (
                        <button
                          key={day.value}
                          type="button"
                          onClick={() => toggleDayOfWeek(day.value)}
                          title={day.full}
                          style={{
                            width: '48px',
                            height: '48px',
                            padding: 0,
                            background: formData.daysOfWeek.includes(day.value) ? '#333' : '#fff',
                            color: formData.daysOfWeek.includes(day.value) ? '#fff' : '#666',
                            border: '1px solid #e0e0e0',
                            borderRadius: '50%',
                            cursor: 'pointer',
                            fontSize: '14px',
                            fontWeight: 600,
                            transition: 'all 0.2s'
                          }}
                          onMouseEnter={(e) => {
                            if (!formData.daysOfWeek.includes(day.value)) {
                              e.currentTarget.style.background = '#f5f5f5';
                            }
                          }}
                          onMouseLeave={(e) => {
                            if (!formData.daysOfWeek.includes(day.value)) {
                              e.currentTarget.style.background = '#fff';
                            }
                          }}
                        >
                          {day.label}
                        </button>
                      ))}
                    </div>
                  </div>
                )}
              </div>

              <div style={{ display: 'flex', gap: '12px', justifyContent: 'flex-end', marginTop: '32px' }}>
                <button type="button" onClick={onClose} disabled={isSaving} style={{ padding: '12px 24px', background: '#fff', color: '#333', border: '1px solid #e0e0e0', borderRadius: '8px', cursor: 'pointer', fontSize: '14px' }}>Cancel</button>
                <button type="submit" disabled={isSaving} style={{ padding: '12px 24px', background: '#333', color: '#fff', border: 'none', borderRadius: '8px', cursor: 'pointer', fontSize: '14px' }}>
                  {isSaving ? 'Saving...' : 'Save Changes'}
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    }



    function EditMeetingModal({ meeting, onClose, onSave }) {
      console.log('EditMeetingModal rendered with meeting:', meeting);
      
      if (!meeting) {
        console.error('EditMeetingModal: meeting is null/undefined');
        onClose();
        return null;
      }
      
      if (!meeting.startDateTime || !meeting.endDateTime) {
        console.error('EditMeetingModal: meeting missing required fields', meeting);
        onClose();
        return null;
      }
      
      const startDate = new Date(meeting.startDateTime);
      const endDate = new Date(meeting.endDateTime);
      
      const [meetingDate, setMeetingDate] = useState(meeting.startDateTime);
      const [startHour, setStartHour] = useState(startDate.getHours() % 12 || 12);
      const [startMinute, setStartMinute] = useState(startDate.getMinutes());
      const [startAmPm, setStartAmPm] = useState(startDate.getHours() >= 12 ? 'PM' : 'AM');
      const [endHour, setEndHour] = useState(endDate.getHours() % 12 || 12);
      const [endMinute, setEndMinute] = useState(endDate.getMinutes());
      const [endAmPm, setEndAmPm] = useState(endDate.getHours() >= 12 ? 'PM' : 'AM');
      const [showDatePicker, setShowDatePicker] = useState(false);

      const handleSubmit = (e) => {
        e.preventDefault();
        
        const start24Hour = startAmPm === 'PM' && startHour !== 12 ? startHour + 12 : (startAmPm === 'AM' && startHour === 12 ? 0 : startHour);
        const end24Hour = endAmPm === 'PM' && endHour !== 12 ? endHour + 12 : (endAmPm === 'AM' && endHour === 12 ? 0 : endHour);
        
        const baseDate = new Date(meetingDate);
        const year = baseDate.getFullYear();
        const month = baseDate.getMonth() + 1;
        const day = baseDate.getDate();
        
        const dstStart = new Date('2026-03-08T02:00:00');
        const dstEnd = new Date('2026-11-01T02:00:00');
        const checkDate = new Date(year, month - 1, day);
        const isDST = checkDate >= dstStart && checkDate < dstEnd;
        const tzOffset = isDST ? '-07:00' : '-08:00';
        
        const startDateTime = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}T${String(start24Hour).padStart(2, '0')}:${String(startMinute).padStart(2, '0')}:00${tzOffset}`;
        const endDateTime = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}T${String(end24Hour).padStart(2, '0')}:${String(endMinute).padStart(2, '0')}:00${tzOffset}`;
        
        console.log('Saving meeting:', {
          startTime: `${startHour}:${String(startMinute).padStart(2, '0')} ${startAmPm}`,
          endTime: `${endHour}:${String(endMinute).padStart(2, '0')} ${endAmPm}`,
          startDateTime,
          endDateTime
        });
        
        onSave({ startDateTime, endDateTime });
      };

      const formatDateOnly = (dateStr) => {
        if (!dateStr) return 'Select date';
        const date = new Date(dateStr);
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric', timeZone: 'America/Los_Angeles' });
      };

      const hours = Array.from({length: 12}, (_, i) => String(i + 1).padStart(2, '0'));
      const minutes = Array.from({length: 60}, (_, i) => String(i).padStart(2, '0'));

      return (
        <div className="modal-overlay">
          <div className="modal" onClick={e => e.stopPropagation()}>
            <h2>Edit Meeting Time</h2>
            <form onSubmit={handleSubmit}>
              <div className="form-group" style={{ position: 'relative', marginBottom: '20px' }}>
                <label>Meeting Date</label>
                <button
                  type="button"
                  className="custom-date-button"
                  onClick={() => setShowDatePicker(!showDatePicker)}
                  style={{ width: '100%', padding: '12px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', textAlign: 'left', background: '#fff', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'space-between', outline: 'none', color: '#333' }}
                >
                  <span>{formatDateOnly(meetingDate)}</span>
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="#666">
                    <path d="M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 18H4V8h16v13z"/>
                  </svg>
                </button>
                <input
                  type="date"
                  className="native-date-input"
                  value={meetingDate ? meetingDate.split('T')[0] : ''}
                  onChange={(e) => {
                    if (e.target.value) {
                      const date = new Date(e.target.value + 'T00:00:00');
                      setMeetingDate(dateToLocalString(date));
                    }
                  }}
                  style={{ width: '100%', padding: '12px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', outline: 'none' }}
                  onFocus={(e) => { e.target.style.borderColor = '#333'; e.target.style.boxShadow = '0 0 0 3px rgba(51, 51, 51, 0.1)'; }}
                  onBlur={(e) => { e.target.style.borderColor = '#e0e0e0'; e.target.style.boxShadow = 'none'; }}
                />
                {showDatePicker && (
                  <>
                    <div 
                      style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, zIndex: 1000 }}
                      onClick={() => setShowDatePicker(false)}
                    />
                    <div style={{ position: 'absolute', top: '100%', left: 0, zIndex: 1001, marginTop: '8px' }}>
                      <DateOnlyPicker
                        value={meetingDate}
                        onChange={(date) => {
                          setMeetingDate(dateToLocalString(date));
                          setShowDatePicker(false);
                        }}
                      />
                    </div>
                  </>
                )}
              </div>

              <div className="datetime-inputs" style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px' }}>
                <div className="form-group">
                  <label>Start Time</label>
                  <div style={{ display: 'flex', gap: '4px', alignItems: 'center' }}>
                    <select value={String(startHour).padStart(2, '0')} onChange={e => setStartHour(parseInt(e.target.value))} style={{ padding: '10px', paddingRight: '32px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', flex: 1, appearance: 'none', backgroundImage: "url(\"data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 12 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 4L6 8L10 4' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E\")", backgroundRepeat: 'no-repeat', backgroundPosition: 'right 10px center', outline: 'none' }}>
                      {hours.map(h => <option key={h} value={h}>{h}</option>)}
                    </select>
                    <span>:</span>
                    <select value={String(startMinute).padStart(2, '0')} onChange={e => setStartMinute(parseInt(e.target.value))} style={{ padding: '10px', paddingRight: '32px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', flex: 1, appearance: 'none', backgroundImage: "url(\"data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 12 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 4L6 8L10 4' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E\")", backgroundRepeat: 'no-repeat', backgroundPosition: 'right 10px center', outline: 'none' }}>
                      {minutes.map(m => <option key={m} value={m}>{m}</option>)}
                    </select>
                    <select value={startAmPm} onChange={e => setStartAmPm(e.target.value)} style={{ padding: '10px', paddingRight: '32px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', width: '80px', appearance: 'none', backgroundImage: "url(\"data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 12 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 4L6 8L10 4' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E\")", backgroundRepeat: 'no-repeat', backgroundPosition: 'right 10px center', outline: 'none' }}>
                      <option value="AM">AM</option>
                      <option value="PM">PM</option>
                    </select>
                  </div>
                </div>

                <div className="form-group">
                  <label>End Time</label>
                  <div style={{ display: 'flex', gap: '4px', alignItems: 'center' }}>
                    <select value={String(endHour).padStart(2, '0')} onChange={e => setEndHour(parseInt(e.target.value))} style={{ padding: '10px', paddingRight: '32px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', flex: 1, appearance: 'none', backgroundImage: "url(\"data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 12 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 4L6 8L10 4' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E\")", backgroundRepeat: 'no-repeat', backgroundPosition: 'right 10px center', outline: 'none' }}>
                      {hours.map(h => <option key={h} value={h}>{h}</option>)}
                    </select>
                    <span>:</span>
                    <select value={String(endMinute).padStart(2, '0')} onChange={e => setEndMinute(parseInt(e.target.value))} style={{ padding: '10px', paddingRight: '32px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', flex: 1, appearance: 'none', backgroundImage: "url(\"data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 12 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 4L6 8L10 4' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E\")", backgroundRepeat: 'no-repeat', backgroundPosition: 'right 10px center', outline: 'none' }}>
                      {minutes.map(m => <option key={m} value={m}>{m}</option>)}
                    </select>
                    <select value={endAmPm} onChange={e => setEndAmPm(e.target.value)} style={{ padding: '10px', paddingRight: '32px', border: '1px solid #e0e0e0', borderRadius: '8px', fontSize: '14px', width: '80px', appearance: 'none', backgroundImage: "url(\"data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 12 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 4L6 8L10 4' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E\")", backgroundRepeat: 'no-repeat', backgroundPosition: 'right 10px center', outline: 'none' }}>
                      <option value="AM">AM</option>
                      <option value="PM">PM</option>
                    </select>
                  </div>
                </div>
              </div>

              <div className="modal-actions">
                <button type="button" className="secondary" onClick={onClose}>Cancel</button>
                <button type="submit">Save Changes</button>
              </div>
            </form>
          </div>
        </div>
      );
    }

    // Main App wrapper with authentication
    function App() {
      const [isAuthenticated, setIsAuthenticated] = useState(false);

      useEffect(() => {
        // Check if already authenticated in this session
        if (sessionStorage.getItem('authenticated') === 'true') {
          setIsAuthenticated(true);
        }
      }, []);

      if (!isAuthenticated) {
        return <PasswordProtection onAuthenticated={() => setIsAuthenticated(true)} />;
      }

      return <MainApp />;
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
